<div class="chat">
  @if (!globalVariables.create_new_chat) {
  <div class="info-top">
    <div (click)="openDialogChannel()" class="team-name c-pointer">
      <img src="./assets/img/channels/tag.svg" alt="">
      @if (channelWithLoggedInUser) {
      <h3>{{ activeChat ? activeChat : channelWithLoggedInUser.name }}</h3>
      }
      <img src="./assets/img/channels/arrow_drop_down.svg" alt="">
    </div>
    <div class="members">
      <div class="avatars">
        @if (getMembers().length == 0 && channelWithLoggedInUser) {
          @for (avatar of channelWithLoggedInUser.members; track avatar; let index = $index) {
          <img [src]="avatar['avatar']" alt="" [ngStyle]="{'margin-left.px': 3 * -7}">
          }
        } @else {
          @for (avatar of getMembers(); track $index) {
            <img [src]="avatar['avatar']" alt="" [ngStyle]="{'margin-left.px': 3 * -7}">
          }
        }
      </div>
      <div class="quantity">
        <p class="font-weight-700">{{ getMembers().length == 0 && channelWithLoggedInUser ? channelWithLoggedInUser.members.length : getMembers().length }}</p>
      </div>
      <div (click)="addMembers()" class="c-pointer">
        <img src="./assets/img/chat/chat-add-member.svg" alt="">
      </div>
    </div>
  </div>
  <div class="chat-block flex flex-column">
    @for (group of (this.firestoreService.groupedMessages | keyvalue); track $index) {
      @if (group.key == (activeChat ? globalVariables.activeChannel.name : channelWithLoggedInUser.name)) {
        @for (dateGroup of (group.value | keyvalue); track $index) {
          <app-date-block-message
            [dateGroup]="dateGroup"
            (currentMessage)="start_thread($event)"
            [chatMessage]="true">
          </app-date-block-message>
        }
      }
    }
  </div>
  <app-writing-box [sendMessage]="'message'"></app-writing-box>
  } @else {
  <app-create-new-chat></app-create-new-chat>
  }
</div>
